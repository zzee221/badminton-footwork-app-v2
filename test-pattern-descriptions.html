<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>独立步伐描述测试</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="supabase-config.js"></script>
    <script src="step-config.js"></script>
    <script src="auth.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { 
            padding: 10px 15px; 
            margin: 5px; 
            cursor: pointer; 
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        .pattern-item {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .pattern-name {
            font-weight: bold;
            color: #007bff;
        }
        .pattern-description {
            margin-top: 5px;
            color: #333;
        }
        .pattern-status {
            margin-top: 5px;
            font-size: 0.9em;
        }
        .free { color: #28a745; }
        .paid { color: #dc3545; }
    </style>
</head>
<body>
    <h1>独立步伐描述功能测试</h1>
    
    <div class="test-section">
        <h3>1. 测试步伐配置结构</h3>
        <button onclick="testStepConfigStructure()">测试配置结构</button>
        <div id="structure-result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. 测试独立描述功能</h3>
        <button onclick="testPatternDescriptions()">测试描述功能</button>
        <div id="description-result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. 显示所有步伐模式详情</h3>
        <button onclick="showAllPatterns()">显示所有模式</button>
        <div id="all-patterns"></div>
    </div>

    <script>
        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function testStepConfigStructure() {
            try {
                logResult('structure-result', '正在测试步伐配置结构...', 'info');
                
                const stepConfig = new StepConfig();
                let testResults = [];
                
                // 测试平行启动 1-2
                const parallel12 = stepConfig.stepConfig.parallel.steps['1-2'];
                if (parallel12.patterns[0].description) {
                    testResults.push('✅ 平行启动 1-2 基础步伐有独立描述');
                } else {
                    testResults.push('❌ 平行启动 1-2 基础步伐缺少独立描述');
                }
                
                if (parallel12.patterns[1].description) {
                    testResults.push('✅ 平行启动 1-2 进阶步伐有独立描述');
                } else {
                    testResults.push('❌ 平行启动 1-2 进阶步伐缺少独立描述');
                }
                
                // 测试前后启动 1-2
                const forwardBackward12 = stepConfig.stepConfig['forward-backward'].steps['1-2'];
                if (forwardBackward12.patterns[0].description) {
                    testResults.push('✅ 前后启动 1-2 基础步伐有独立描述');
                } else {
                    testResults.push('❌ 前后启动 1-2 基础步伐缺少独立描述');
                }
                
                const totalTests = testResults.length;
                const passedTests = testResults.filter(r => r.includes('✅')).length;
                
                logResult('structure-result', 
                    `测试完成！<br>
                    通过：${passedTests}/${totalTests}<br><br>
                    ${testResults.join('<br>')}`, 
                    passedTests === totalTests ? 'success' : 'error'
                );
                
            } catch (err) {
                logResult('structure-result', `测试失败：${err.message}`, 'error');
            }
        }

        function testPatternDescriptions() {
            try {
                logResult('description-result', '正在测试独立描述功能...', 'info');
                
                const stepConfig = new StepConfig();
                const testStep = stepConfig.stepConfig.parallel.steps['1-2'];
                
                let description = '';
                
                // 模拟显示第一个pattern的描述
                const currentPattern = testStep.patterns[0];
                if (currentPattern.description) {
                    description = `<strong>${currentPattern.name}：</strong>${currentPattern.description}`;
                } else {
                    description = testStep.description;
                }
                
                // 添加整体描述（可选）
                if (testStep.patterns.length > 1 && currentPattern.description) {
                    description += `<br><br><em>整体描述：${testStep.description}</em>`;
                }
                
                logResult('description-result', 
                    `独立描述功能测试成功！<br><br>
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        ${description}
                    </div>`, 
                    'success'
                );
                
            } catch (err) {
                logResult('description-result', `测试失败：${err.message}`, 'error');
            }
        }

        function showAllPatterns() {
            try {
                const stepConfig = new StepConfig();
                const allPatternsDiv = document.getElementById('all-patterns');
                
                let html = '<h4>所有步伐模式详情：</h4>';
                
                // 遍历所有启动方式
                for (const [stepType, stepTypeConfig] of Object.entries(stepConfig.stepConfig)) {
                    html += `<h5>${stepTypeConfig.name}：</h5>`;
                    
                    // 遍历所有点位组合
                    for (const [sequence, stepData] of Object.entries(stepTypeConfig.steps)) {
                        html += `<h6>${stepData.name} (${sequence})：</h6>`;
                        
                        // 遍历所有模式
                        for (const pattern of stepData.patterns) {
                            const hasDescription = pattern.description ? '✅' : '❌';
                            const statusClass = pattern.isFree ? 'free' : 'paid';
                            const statusText = pattern.isFree ? '免费' : '付费';
                            
                            html += `
                                <div class="pattern-item">
                                    <div class="pattern-name">${pattern.name}</div>
                                    <div class="pattern-status">${hasDescription} 独立描述 | <span class="${statusClass}">${statusText}</span></div>
                                    ${pattern.description ? `<div class="pattern-description">${pattern.description}</div>` : '<div class="pattern-description" style="color: #999;">无独立描述</div>'}
                                </div>
                            `;
                        }
                    }
                }
                
                allPatternsDiv.innerHTML = html;
                
            } catch (err) {
                document.getElementById('all-patterns').innerHTML = `<div class="error">显示失败：${err.message}</div>`;
            }
        }

        // 页面加载时自动测试
        window.addEventListener('load', function() {
            setTimeout(() => {
                testStepConfigStructure();
            }, 1000);
        });
    </script>
</body>
</html>