# 羽毛球步伐训练应用 - 女单步伐功能扩展指南

## 项目概述

本指南详细说明如何在现有的羽毛球步伐训练应用中新增女单步伐MP4视频展示功能，采用【男单/女单步伐——平行/前后启动——具体步伐】的网页结构，并为后续双打步伐功能预留接口。

## 当前项目状态

### 现有文件结构
```
badminton-footwork-app-v2/
├── index.html              # 主页面
├── script.js              # 前端交互逻辑
├── step-config.js         # 步伐配置数据
├── supabase-config.js     # 数据库连接配置
├── styles.css             # 样式文件
├── 步伐MP4图/             # 男单步伐视频文件夹
│   ├── 前后启动/          # 男单前后启动步伐视频
│   └── 平行启动/          # 男单平行启动步伐视频
└── 女单步伐MP4图/         # 女单步伐视频文件夹
    ├── 前后启动/          # 女单前后启动步伐视频
    └── 平行启动/          # 女单平行启动步伐视频
```

### 现有功能分析
- **页面结构**: 仅支持平行/前后启动两种类型选择
- **步伐配置**: step-config.js中只包含男单相关步伐数据
- **视频资源**: 已有完整的男单和女单步伐MP4视频文件
- **数据库**: 已更新Supabase连接配置

## 扩展方案设计

### 1. 数据库设计

#### 新增表结构

```sql
-- 步伐分类表
CREATE TABLE step_categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,           -- 分类名称：男单、女单、双打
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 步伐视频表
CREATE TABLE step_videos (
    id SERIAL PRIMARY KEY,
    category_id INTEGER REFERENCES step_categories(id),
    start_type VARCHAR(20) NOT NULL,      -- 启动类型：前后启动、平行启动
    point_pattern VARCHAR(20) NOT NULL,   -- 点位模式：1-2, 1-3, 1-4等
    video_path VARCHAR(255) NOT NULL,    -- 视频文件路径
    description TEXT,                    -- 步伐描述
    special_note VARCHAR(100),           -- 特殊说明（如：马来步、交叉等）
    difficulty_level INTEGER DEFAULT 1,  -- 难度等级 1-5
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 用户学习记录表
CREATE TABLE user_learning_records (
    id SERIAL PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id),
    video_id INTEGER REFERENCES step_videos(id),
    view_count INTEGER DEFAULT 0,
    last_viewed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 初始化数据

```sql
-- 插入步伐分类数据
INSERT INTO step_categories (name, description) VALUES 
('男单', '男子单打步伐训练'),
('女单', '女子单打步伐训练'),
('双打', '双打步伐训练（预留）');

-- 创建索引优化查询性能
CREATE INDEX idx_step_videos_category ON step_videos(category_id);
CREATE INDEX idx_step_videos_start_type ON step_videos(start_type);
CREATE INDEX idx_step_videos_pattern ON step_videos(point_pattern);
CREATE INDEX idx_user_learning_user_video ON user_learning_records(user_id, video_id);
```

### 2. 前端界面设计

#### 页面结构修改

在现有的index.html中添加性别分类选择器：

```html
<!-- 在步伐类型选择器之前添加性别分类选择器 -->
<div class="category-selector">
    <h3>选择步伐分类</h3>
    <div class="category-buttons">
        <button class="category-btn active" data-category="mens">男单步伐</button>
        <button class="category-btn" data-category="womens">女单步伐</button>
        <button class="category-btn" data-category="doubles" disabled>双打步伐（开发中）</button>
    </div>
</div>
```

#### 步伐列表展示优化

```html
<!-- 优化步伐列表展示 -->
<div class="step-list-container">
    <div class="step-list-header">
        <h3 id="step-list-title">男单步伐 - 前后启动</h3>
        <div class="filter-controls">
            <select id="difficulty-filter" class="difficulty-select">
                <option value="all">所有难度</option>
                <option value="1">初级</option>
                <option value="2">初中级</option>
                <option value="3">中级</option>
                <option value="4">中高级</option>
                <option value="5">高级</option>
            </select>
        </div>
    </div>
    <div id="step-list" class="step-list">
        <!-- 步伐项目将通过JavaScript动态生成 -->
    </div>
</div>
```

### 3. 配置文件重构

#### step-config.js 重构

```javascript
// 步伐配置数据 - 采用分类结构
const stepConfig = {
    categories: {
        mens: {
            name: '男单步伐',
            description: '男子单打步伐训练',
            startTypes: {
                '前后启动': {
                    patterns: [
                        { id: '1-2', video: '步伐MP4图/前后启动1-2.mp4', description: '前后启动1-2点位' },
                        { id: '1-3', video: '步伐MP4图/前后启动1-3.mp4', description: '前后启动1-3点位' },
                        { id: '1-4', video: '步伐MP4图/前后启动1-4.mp4', description: '前后启动1-4点位' },
                        { id: '1-5', video: '步伐MP4图/前后启动1-5.mp4', description: '前后启动1-5点位' },
                        // 更多男单前后启动步伐...
                    ]
                },
                '平行启动': {
                    patterns: [
                        { id: '1-2', video: '步伐MP4图/平行启动1-2.mp4', description: '平行启动1-2点位' },
                        { id: '1-3', video: '步伐MP4图/平行启动1-3.mp4', description: '平行启动1-3点位' },
                        { id: '1-4', video: '步伐MP4图/平行启动1-4.mp4', description: '平行启动1-4点位' },
                        { id: '1-5', video: '步伐MP4图/平行启动1-5.mp4', description: '平行启动1-5点位' },
                        // 更多男单平行启动步伐...
                    ]
                }
            }
        },
        womens: {
            name: '女单步伐',
            description: '女子单打步伐训练',
            startTypes: {
                '前后启动': {
                    patterns: [
                        { id: '1-2', video: '女单步伐MP4图/前后启动1-2.mp4', description: '前后启动1-2点位' },
                        { id: '1-3', video: '女单步伐MP4图/前后启动1-3.mp4', description: '前后启动1-3点位' },
                        { id: '1-4', video: '女单步伐MP4图/前后启动1-4（小碎步）.mp4', description: '前后启动1-4点位（小碎步）' },
                        { id: '1-4-malay', video: '女单步伐MP4图/前后启动1-4（马来步）.mp4', description: '前后启动1-4点位（马来步）' },
                        { id: '1-5', video: '女单步伐MP4图/前后启动1-5.mp4', description: '前后启动1-5点位' },
                        // 更多女单前后启动步伐...
                    ]
                },
                '平行启动': {
                    patterns: [
                        { id: '1-2', video: '女单步伐MP4图/平行启动1-2.mp4', description: '平行启动1-2点位' },
                        { id: '1-3', video: '女单步伐MP4图/平行启动1-3.mp4', description: '平行启动1-3点位' },
                        { id: '1-4-small', video: '女单步伐MP4图/平行启动1-4（小碎步）.mp4', description: '平行启动1-4点位（小碎步）' },
                        { id: '1-4-malay', video: '女单步伐MP4图/平行启动1-4（马来步）.mp4', description: '平行启动1-4点位（马来步）' },
                        { id: '1-5-cross', video: '女单步伐MP4图/平行启动1-5（交叉）.mp4', description: '平行启动1-5点位（交叉）' },
                        { id: '1-5-parallel', video: '女单步伐MP4图/平行启动1-5（并步）.mp4', description: '平行启动1-5点位（并步）' },
                        // 更多女单平行启动步伐...
                    ]
                }
            }
        },
        doubles: {
            name: '双打步伐',
            description: '双打步伐训练（预留功能）',
            startTypes: {
                '前后启动': { patterns: [] },
                '平行启动': { patterns: [] }
            }
        }
    }
};

// 导出配置
window.stepConfig = stepConfig;
```

### 4. 核心功能实现

#### StepManager 类设计

```javascript
class StepManager {
    constructor() {
        this.currentCategory = 'mens';
        this.currentStartType = '前后启动';
        this.currentDifficulty = 'all';
        this.supabase = window.supabase;
        this.init();
    }

    init() {
        this.bindEvents();
        this.loadStepList();
    }

    bindEvents() {
        // 分类切换事件
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if (!e.target.disabled) {
                    this.switchCategory(e.target.dataset.category);
                }
            });
        });

        // 启动类型切换事件
        document.querySelectorAll('.start-type-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchStartType(e.target.dataset.startType);
            });
        });

        // 难度筛选事件
        document.getElementById('difficulty-filter').addEventListener('change', (e) => {
            this.currentDifficulty = e.target.value;
            this.loadStepList();
        });
    }

    switchCategory(category) {
        this.currentCategory = category;
        
        // 更新按钮状态
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.category === category);
        });
        
        // 更新页面标题
        const categoryName = stepConfig.categories[category].name;
        document.getElementById('step-list-title').textContent = 
            `${categoryName} - ${this.currentStartType}`;
        
        this.loadStepList();
    }

    switchStartType(startType) {
        this.currentStartType = startType;
        
        // 更新按钮状态
        document.querySelectorAll('.start-type-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.startType === startType);
        });
        
        // 更新页面标题
        const categoryName = stepConfig.categories[this.currentCategory].name;
        document.getElementById('step-list-title').textContent = 
            `${categoryName} - ${startType}`;
        
        this.loadStepList();
    }

    async loadStepList() {
        const stepList = document.getElementById('step-list');
        stepList.innerHTML = '<div class="loading">加载中...</div>';
        
        try {
            // 从配置文件获取步伐数据
            const categoryData = stepConfig.categories[this.currentCategory];
            const startTypeData = categoryData.startTypes[this.currentStartType];
            
            if (!startTypeData || !startTypeData.patterns) {
                stepList.innerHTML = '<div class="no-data">暂无相关步伐数据</div>';
                return;
            }
            
            // 筛选步伐数据
            let patterns = startTypeData.patterns;
            if (this.currentDifficulty !== 'all') {
                patterns = patterns.filter(pattern => 
                    pattern.difficulty === parseInt(this.currentDifficulty)
                );
            }
            
            // 生成步伐列表HTML
            const stepHTML = patterns.map(pattern => `
                <div class="step-item" data-pattern="${pattern.id}">
                    <div class="step-video">
                        <video controls preload="metadata">
                            <source src="${pattern.video}" type="video/mp4">
                            您的浏览器不支持视频播放。
                        </video>
                    </div>
                    <div class="step-info">
                        <h4>${pattern.description}</h4>
                        <div class="step-meta">
                            <span class="pattern-id">点位: ${pattern.id}</span>
                            ${pattern.difficulty ? `<span class="difficulty">难度: ${pattern.difficulty}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            stepList.innerHTML = stepHTML;
            
            // 记录用户学习行为
            await this.recordLearningActivity(patterns);
            
        } catch (error) {
            console.error('加载步伐列表失败:', error);
            stepList.innerHTML = '<div class="error">加载失败，请重试</div>';
        }
    }

    async recordLearningActivity(patterns) {
        try {
            const user = this.supabase.auth.user();
            if (!user) return;
            
            // 记录用户查看的步伐
            for (const pattern of patterns) {
                const { data, error } = await this.supabase
                    .from('user_learning_records')
                    .upsert({
                        user_id: user.id,
                        video_id: pattern.id,
                        view_count: 1,
                        last_viewed_at: new Date().toISOString()
                    }, {
                        onConflict: 'user_id,video_id'
                    });
                
                if (error) {
                    console.error('记录学习数据失败:', error);
                }
            }
        } catch (error) {
            console.error('记录学习活动失败:', error);
        }
    }
}

// 初始化步伐管理器
document.addEventListener('DOMContentLoaded', () => {
    window.stepManager = new StepManager();
});
```

## 实施计划

### 第一阶段：基础功能实现（1-2周）

#### 目标
- 完成数据库表结构创建和数据初始化
- 实现前端界面分类切换功能
- 完成步伐配置文件重构
- 实现基本的步伐列表展示

#### 任务清单
1. **数据库迁移**
   - 执行SQL脚本创建新表结构
   - 初始化基础分类数据
   - 测试数据库连接和查询

2. **前端界面修改**
   - 修改index.html添加分类选择器
   - 更新CSS样式适配新界面
   - 实现响应式布局

3. **配置文件重构**
   - 重构step-config.js采用分类结构
   - 整理男单和女单步伐数据
   - 添加难度等级等元数据

4. **核心功能开发**
   - 实现StepManager类
   - 完成分类切换逻辑
   - 实现步伐列表动态加载

### 第二阶段：功能完善和优化（1周）

#### 目标
- 完善用户学习记录功能
- 添加难度筛选功能
- 优化视频播放体验
- 为双打功能预留接口

#### 任务清单
1. **学习记录功能**
   - 实现用户学习行为记录
   - 添加学习进度统计
   - 实现学习历史查看

2. **筛选和搜索**
   - 实现难度等级筛选
   - 添加步伐搜索功能
   - 优化筛选器交互体验

3. **视频播放优化**
   - 添加视频预加载功能
   - 实现播放进度记忆
   - 优化移动端播放体验

4. **接口预留**
   - 为双打步伐预留数据结构
   - 设计扩展性接口
   - 完善错误处理机制

## 技术要点

### 1. 数据库设计要点
- **表关系设计**: step_videos表通过category_id关联step_categories表
- **索引优化**: 为常用查询字段创建索引提高性能
- **数据完整性**: 使用外键约束确保数据一致性
- **扩展性**: 预留双打分类和相关字段

### 2. 前端架构要点
- **组件化设计**: StepManager类封装所有步伐相关功能
- **状态管理**: 使用类属性管理当前分类、启动类型等状态
- **事件驱动**: 通过事件监听实现用户交互响应
- **数据分离**: 配置数据与业务逻辑分离

### 3. 性能优化要点
- **视频加载优化**: 使用preload="metadata"减少初始加载时间
- **DOM操作优化**: 批量更新DOM减少重绘次数
- **异步处理**: 使用async/await处理数据库操作
- **缓存策略**: 考虑添加本地缓存减少重复请求

### 4. 用户体验要点
- **界面一致性**: 保持男单/女单界面风格统一
- **交互反馈**: 添加加载状态和错误提示
- **响应式设计**: 适配不同屏幕尺寸
- **无障碍访问**: 添加适当的ARIA标签

## 风险评估

### 技术风险
1. **数据库迁移风险**: 新表结构可能与现有数据冲突
   - 缓解措施: 先在测试环境验证，备份生产数据

2. **浏览器兼容性**: 视频播放在不同浏览器可能有差异
   - 缓解措施: 测试主流浏览器，提供降级方案

3. **性能问题**: 大量视频文件可能影响加载速度
   - 缓解措施: 实现懒加载，优化视频文件大小

### 业务风险
1. **用户接受度**: 新功能可能影响现有用户使用习惯
   - 缓解措施: 保持原有功能可用，提供使用指南

2. **数据准确性**: 步伐分类和描述可能存在错误
   - 缓解措施: 请专业教练审核内容

## 成功标准

### 功能标准
- [ ] 用户可以在男单/女单步伐之间切换
- [ ] 每个分类下都能正常显示前后启动和平行启动步伐
- [ ] 所有视频文件都能正常播放
- [ ] 难度筛选功能正常工作
- [ ] 用户学习记录能够正确保存

### 性能标准
- [ ] 页面加载时间 < 3秒
- [ ] 视频开始播放时间 < 2秒
- [ ] 分类切换响应时间 < 1秒
- [ ] 数据库查询响应时间 < 500ms

### 用户体验标准
- [ ] 界面布局清晰，操作直观
- [ ] 移动端适配良好
- [ ] 错误提示友好明确
- [ ] 无明显bug或功能缺陷

## 后续扩展计划

### 双打步伐功能
1. **数据准备**: 收集整理双打步伐视频文件
2. **界面扩展**: 添加双打特有的界面元素
3. **功能开发**: 实现双打步伐的特殊逻辑

### 学习分析功能
1. **数据统计**: 添加学习时长、次数等统计
2. **进度跟踪**: 实现学习进度可视化
3. **个性化推荐**: 基于学习数据推荐步伐

### 社交功能
1. **分享功能**: 允许用户分享学习成果
2. **排行榜**: 添加学习排名功能
3. **评论系统**: 用户可以对步伐进行评论

## 维护和更新

### 日常维护
- 定期检查数据库性能
- 监控视频文件访问情况
- 更新步伐内容和描述
- 修复用户反馈的问题

### 版本更新
- 定期发布功能更新
- 保持向后兼容性
- 更新相关文档
- 通知用户新功能

---

**文档版本**: v1.0  
**创建日期**: 2024年  
**最后更新**: 2024年  
**维护人员**: 开发团队